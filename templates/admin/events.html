{% extends 'layout.html' %}

{% block content %}
<div class="main-content">
  <div class="page-header">
    <h1>📅 All Scheduled Events</h1>
  </div>

  <div class="calendar-card">
    <table>
      <thead>
        <tr>
          <th>📝 Title</th>
          <th>📄 Description</th>
          <th>🕒 Time</th>
          <th>🎭 Role</th>
          <th>🔁 Recurrence</th>
          {% if session.get("user") %}
            <th>⚙️ Actions</th>
          {% endif %}
        </tr>
      </thead>
      <tbody>
        {% for event in events %}
        <tr class="{% if event.event_time < now %}past-event{% endif %}">
          <td>{{ event.title }}</td>
          <td>{{ event.description[:50] }}{% if event.description|length > 50 %}...{% endif %}</td>
          <td data-time="{{ event.event_time }}">{{ event.event_time }}</td>
          <td>{{ event.role or '-' }}</td>
          <td>{{ event.recurrence or 'None' }}</td>
          {% if session.get("user") %}
            <td>
              <a href="/edit/{{ event.id }}" title="Edit">✏️</a>
              <form action="/delete/{{ event.id }}" method="POST" style="display:inline;" onsubmit="return confirm('❗Delete?')">
                <button type="submit" style="background:none;border:none;color:red;">❌</button>
              </form>
              <a href="/participants/{{ event.id }}" title="Participants">👥</a>
            </td>
          {% endif %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const rows = document.querySelectorAll('td[data-time]');
    const now = new Date();

    rows.forEach(cell => {
      const eventTime = new Date(cell.dataset.time);
      if (eventTime < now) {
        cell.parentElement.classList.add('past-event');
      }
    });
  });
</script>

{% endblock %}
